<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Conflict Map - Map View</title>

    <!-- D3.js v7 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- TopoJSON for world map data -->
    <script src="https://unpkg.com/topojson@3"></script>

    <!-- CSS: Unified stylesheet -->
    <link rel="stylesheet" href="globe.css">
</head>

<body>
    <!-- View Mode Toggle -->
    <div class="view-mode-toggle">
        <button class="view-mode-btn active" id="map-view-btn" onclick="window.location.href='index.html'">
            üó∫Ô∏è Map View
        </button>
        <button class="view-mode-btn" id="graph-view-btn" onclick="window.location.href='graph.html'">
            üîó Graph View
        </button>
    </div>

    <!-- Main Container with 3-column layout -->
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1 class="title">Global Conflict Map</h1>
            <p class="subtitle">Global Conflict Analysis - UCDP GED Dataset (Country View)</p>
        </header>

        <!-- Main Content: 3 columns (Flexbox layout) -->
        <div class="content-wrapper">
            <!-- LEFT PANEL: Statistics & Filters -->
            <aside class="left-panel" id="left-panel">
                <!-- Statistics Container -->
                <div class="stats-container">
                    <h3>Overview Statistics</h3>
                    <div class="stat-item">
                        <span class="stat-label">Total Events:</span>
                        <span id="total-events" class="stat-value">...</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Casualties:</span>
                        <span id="total-casualties" class="stat-value">...</span>
                    </div>
                </div>

                <!-- Region Legend -->
                <div class="legend-section">
                    <h3>Regions</h3>
                    <div id="legend" class="legend-container"></div>
                </div>

                <!-- Violence Type Filter -->
                <div class="violence-filter-section">
                    <h3>Violence Type</h3>
                    <div id="violence-type-filter" class="legend-container"></div>
                </div>

                <!-- Back Button (hidden by default) -->
                <button id="reset-zoom" class="reset-btn" style="display: none;">
                    ‚Üê Back
                </button>
            </aside>

            <!-- CENTER: World Map View -->
            <main class="map-section">
                <!-- World Map SVG -->
                <svg id="world-map"></svg>

                <!-- Time Slider Control -->
                <div class="time-slider-container">
                    <div class="slider-labels">
                        <span id="year-start">1989</span>
                        <span id="year-current" class="current-year">2023</span>
                        <span id="year-end">2023</span>
                    </div>
                    <input type="range" id="year-slider" min="1989" max="2023" value="2023" step="1">
                    <div class="slider-controls">
                        <button id="play-btn" class="play-btn">‚ñ∂ Play</button>
                    </div>
                </div>

                <!-- Event Details Modal -->
                <div id="event-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h2 id="modal-title">Event Details</h2>
                        <div class="modal-body">
                            <div class="modal-meta">
                                <span id="modal-date">Date</span> ‚Ä¢
                                <span id="modal-type">Type</span>
                            </div>
                            <div class="modal-stats">
                                <div class="stat-box">
                                    <span class="stat-label">Casualties</span>
                                    <span id="modal-casualties" class="stat-number">0</span>
                                </div>
                            </div>
                            <div class="modal-details">
                                <h4>Source Information</h4>
                                <p><strong>Source:</strong> <span id="modal-source">Unknown</span></p>
                                <p><strong>Headline:</strong> <span id="modal-headline">N/A</span></p>
                                <p><strong>Description:</strong> <span id="modal-description">No description
                                        available.</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- RIGHT PANEL: Statistical Charts (Built dynamically by global-new.js) -->
            <aside class="right-panel" id="charts-panel" style="display: none;">
                <!-- Content is built dynamically by updateDashboardUILocal() in global-new.js -->
                <!-- Structure matches graph.html but rendered via JavaScript -->
            </aside>
        </div>

        <!-- Panel Toggle Buttons -->
        <button class="panel-toggle-btn" id="left-panel-toggle" title="Toggle filters panel">‚óÄ</button>
        <button class="panel-toggle-btn" id="right-panel-toggle" title="Toggle statistics panel">‚ñ∂</button>

        <!-- Hover Reveal Triggers -->
        <div class="panel-reveal-trigger left" id="left-reveal-trigger"></div>
        <div class="panel-reveal-trigger right" id="right-reveal-trigger"></div>
    </div>

    <!-- Load shared utilities first -->
    <script src="js/ui/shared.js"></script>
    <!-- Load core data modules -->
    <script src="js/core/viewStateManager.js"></script>
    <script src="js/core/dataFilterManager.js"></script>
    <script src="js/core/aggregationManager.js"></script>
    <script src="js/core/DataManager.js"></script>
    <!-- Load rendering modules -->
    <script src="js/rendering/renderingEngine.js"></script>
    <script src="js/rendering/cleanupManager.js"></script>
    <script src="js/rendering/LayerManager.js"></script>
    <script src="js/rendering/GraphOptimizer.js"></script>
    <!-- Load UI modules -->
    <script src="js/ui/ChartRenderer.js"></script>
    <script src="js/ui/FilterPanel.js"></script>
    <!-- Load Map View script -->
    <script src="global-new.js"></script>

</body>

</html>